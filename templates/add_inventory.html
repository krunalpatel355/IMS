{% extends "base.html" %}

{% block content %}
<div class="container">
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-danger">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <form id="inventoryForm" class="inventory-form" method="post" enctype="multipart/form-data">
        {{ form.csrf_token }}
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-info-circle"></i>
                Basic Information
            </h2>
            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="productImage">Product Image</label>
                    <div class="dropzone-wrapper" id="dropzoneUpload">
                        <div class="dropzone-content">
                            <div class="upload-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                            </div>
                            <div class="upload-text">
                                <span class="primary-text">Drop your image here or</span>
                                <label for="productImage" class="browse-link">browse files</label>
                            </div>
                            <div class="file-info">Supported: JPG, PNG (max 5MB)</div>
                        </div>
                        <div class="preview-container" id="previewContainer">
                            <img id="imagePreview" class="preview-image" alt="Preview">
                            <button type="button" class="remove-image" id="removeImage" aria-label="Remove image">Ã—</button>
                        </div>
                        <input type="file" id="productImage" name="productImage" accept="image/jpeg,image/png" required class="file-input">
                    </div>
                </div>

                <div class="form-group">
                    <label for="productName">Product Name</label>
                    <input type="text" id="productName" name="name" required placeholder="Enter product name">
                </div>

                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" name="category" required>
                        <option value="">Select category</option>
                        <option value="electronics">Electronics</option>
                        <option value="automotive">Automotive</option>
                        <option value="tools">Tools</option>
                        <option value="accessories">Accessories</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="subCategory">Sub-Category</label>
                    <input type="text" id="subCategory" name="sub_category" required placeholder="Enter sub-category">
                </div>

                <div class="form-group">
                    <label for="tag">Tags</label>
                    <input type="text" id="tag" name="tags" placeholder="Enter tags (comma separated)">
                </div>

                <div class="form-group">
                    <label for="sku">SKU</label>
                    <input type="text" id="sku" name="sku" required placeholder="Enter SKU">
                </div>
            </div>
        </div>

        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-truck"></i>
                Source Information
            </h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="origin">Origin</label>
                    <input type="text" id="origin" name="origin" required placeholder="Country of origin">
                </div>

                <div class="form-group">
                    <label for="supplier">Supplier</label>
                    <select id="supplier" name="supplier" required>
                        <option value="">Select supplier</option>
                        <option value="supplier1">Supplier 1</option>
                        <option value="supplier2">Supplier 2</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="owner">Owner</label>
                    <input type="text" id="owner" name="owner" required placeholder="Product owner">
                </div>

                <div class="form-group">
                    <label for="brand">Brand</label>
                    <input type="text" id="brand" name="brand" required placeholder="Product brand">
                </div>
            </div>
        </div>

        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-box"></i>
                Inventory Details
            </h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="stock">Stock Quantity</label>
                    <input type="number" id="stock" name="stock" min="0" required placeholder="Available quantity">
                </div>

                <div class="form-group">
                    <label for="minStock">Minimum Stock Level</label>
                    <input type="number" id="minStock" name="min_stock" min="0" required placeholder="Alert threshold">
                </div>

                <div class="form-group">
                    <label for="landingCost">Landing Cost</label>
                    <div class="input-group">
                        <span class="input-addon">$</span>
                        <input type="number" id="landingCost" name="landing_cost" step="0.01" min="0" required placeholder="0.00">
                    </div>
                </div>

                <div class="form-group">
                    <label for="sellingPrice">Selling Price</label>
                    <div class="input-group">
                        <span class="input-addon">$</span>
                        <input type="number" id="sellingPrice" name="price" step="0.01" min="0" required placeholder="0.00">
                    </div>
                </div>

                <div class="form-group">
                    <label for="location">Storage Location</label>
                    <input type="text" id="location" name="location" required placeholder="Warehouse location">
                </div>

                <div class="form-group">
                    <label for="condition">Condition</label>
                    <select id="condition" name="condition" required>
                        <option value="new">New</option>
                        <option value="used">Used</option>
                        <option value="refurbished">Refurbished</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-cogs"></i>
                Technical Details
            </h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="application">Application</label>
                    <input type="text" id="application" name="application" placeholder="Product application">
                </div>

                <div class="form-group">
                    <label for="partNumber">Part Number</label>
                    <input type="text" id="partNumber" name="part_number" required placeholder="Manufacturer part number">
                </div>

                <div class="form-group">
                    <label for="oemNumber">OEM Number</label>
                    <input type="text" id="oemNumber" name="oem_number" placeholder="OEM reference number">
                </div>

                <div class="form-group full-width">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="3" placeholder="Detailed product description"></textarea>
                </div>

                <div class="form-group">
                    <label for="warranty">Warranty Period</label>
                    <input type="text" id="warranty" name="warranty" placeholder="e.g., 12 months">
                </div>

                <div class="form-group">
                    <label for="certification">Certifications</label>
                    <input type="text" id="certification" name="certifications" placeholder="e.g., ISO, CE">
                </div>
            </div>
        </div>

        <div class="form-actions">
            <div class="btn-group">
                <button type="submit" class="btn-submit">
                    <i class="fas fa-plus"></i>
                    Add Product
                </button>
                <button type="button" class="btn-draft">
                    <i class="fas fa-save"></i>
                    Save as Draft
                </button>
            </div>
            <button type="reset" class="btn-reset">
                <i class="fas fa-undo"></i>
                Reset
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const dropzone = document.getElementById('dropzoneUpload');
    const fileInput = document.getElementById('productImage');
    const previewContainer = document.getElementById('previewContainer');
    const previewImage = document.getElementById('imagePreview');
    const removeButton = document.getElementById('removeImage');

    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropzone.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    // Highlight dropzone when dragging over it
    ['dragenter', 'dragover'].forEach(eventName => {
        dropzone.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropzone.addEventListener(eventName, unhighlight, false);
    });

    // Handle dropped files
    dropzone.addEventListener('drop', handleDrop, false);
    
    // Handle manual file selection
    fileInput.addEventListener('change', handleFiles, false);
    
    // Handle remove button click
    removeButton.addEventListener('click', removeFile, false);

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function highlight(e) {
        dropzone.classList.add('dragover');
    }

    function unhighlight(e) {
        dropzone.classList.remove('dragover');
    }

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles({ target: { files } });
    }

    function handleFiles(e) {
        const files = e.target.files;
        if (files.length) {
            const file = files[0];
            
            // Validate file type
            if (!file.type.match('image.*')) {
                alert('Please upload an image file (JPEG or PNG).');
                return;
            }
            
            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('File size should not exceed 5MB.');
                return;
            }

            // Update file input
            fileInput.files = files;
            
            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                previewContainer.classList.add('active');
                dropzone.querySelector('.dropzone-content').style.display = 'none';
            }
            reader.readAsDataURL(file);
        }
    }

    function removeFile() {
        fileInput.value = '';
        previewImage.src = '';
        previewContainer.classList.remove('active');
        dropzone.querySelector('.dropzone-content').style.display = 'flex';
    }
});
</script>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}