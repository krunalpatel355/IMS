{% extends "base.html" %}

{% block content %}
<div class="customers-container">
    <div class="header-section">
        <h1>Customers</h1>
        <div class="actions-bar">
            <div class="search-section">
                <input type="text" id="customerSearch" placeholder="Search customers...">
            </div>
            <a href="{{ url_for('add_customer') }}" class="add-button awesome-btn">
                <i class="fas fa-user-plus"></i> Add New Customer
            </a>
        </div>
    </div>
    
    <div class="customers-grid">
        {% for customer in customers %}
        <div class="customer-card">
            <div class="customer-header">
                <i class="fas fa-user-circle customer-avatar"></i>
                <div class="customer-info">
                    <h2>{{ customer.name if customer.name else 'No Contact Name' }}</h2>
                    <span class="company-name">{{ customer.company }}</span>
                </div>
            </div>
            
            <div class="customer-details">
                <p><i class="fas fa-envelope"></i> {{ customer.email }}</p>
                <p><i class="fas fa-phone"></i> {{ customer.phone }}</p>
                {% if customer.type %}
                <p><i class="fas fa-tag"></i> {{ customer.type }}</p>
                {% endif %}
            </div>
            
            {% if customer.purchases %}
            <div class="recent-activity">
                <h3><i class="fas fa-history"></i> Recent Purchases</h3>
                <ul>
                    {% for purchase in customer.purchases[:3] %}
                    <li>{{ purchase.item_name }} - ${{ "%.2f"|format(purchase.amount) }}</li>
                    {% endfor %}
                </ul>
                {% if customer.purchases|length > 3 %}
                <div class="more-indicator">+ {{ customer.purchases|length - 3 }} more</div>
                {% endif %}
            </div>
            {% endif %}
            
            <div class="card-actions">
                <a href="{{ url_for('customer_history', customer_id=customer._id) }}" class="view-btn">
                    <i class="fas fa-history"></i> View History
                </a>
            </div>
        </div>
        {% else %}
        <div class="no-customers">
            <p>No customers found. Add your first customer!</p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
document.getElementById('customerSearch').addEventListener('keyup', function() {
    let searchText = this.value.toLowerCase();
    let cards = document.querySelectorAll('.customer-card');
    
    cards.forEach(card => {
        let text = card.textContent.toLowerCase();
        card.style.display = text.includes(searchText) ? '' : 'none';
    });
});
</script>
{% endblock %}